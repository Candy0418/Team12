<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-twzipcode@1.7.14/jquery.twzipcode.min.js"></script>
{#    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"#}
{#            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"#}
{#            crossorigin="anonymous"></script>#}
{#    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"#}
{#            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"#}
{#            crossorigin="anonymous"></script>#}
{#    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"#}
{#            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"#}
{#            crossorigin="anonymous"></script>#}
    <meta name="generator"
          content="HTML Tidy for HTML5 (experimental) for Windows https://github.com/w3c/tidy-html5/tree/c63cc39"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="author" content="colorlib.com"/>
    <link rel="stylesheet" href="../static/css/main.css"/>
{#    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"#}
{#          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">#}
    <style>
        #map {
            height: 400px;
            weight: 100%;
        }
    </style>
</head>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAgvvjFFN4uKJg3Pw7yDQNfdB4S26OJSXE&callback=initMap">
</script>

<script>
    src = "jquery-3.2.1.min.js";
    //MAP CODE//////////////////////////////////////////////////////////////////////
    var map, geocoder, address;

    //map初始化
    function initMap() {
        address = "{{ address }}";
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -34.397, lng: 150.644},
            zoom: 15
        });
        //User未輸入address時, 顯示使用者當前的GPS位置
        if (address === "None") {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }
        //若User已輸入addrsss, 啟動Google Maps API Geocoder, 將User輸入的address轉換為經緯度
        else {
            geocoder = new google.maps.Geocoder();
            geocoder.geocode(
                {'address': address},
                function (results, status) {
                    if (status === "OK") {
                        //設置地圖的檢視中心點
                        map.setCenter(results[0].geometry.location);
                        //督進圖釘
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location
                        });
                    } else {
                        alert("MDFK Status Error: " + status);
                    }
                }
            )
        }
    }

    //GMaps Error Handler
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }

    //END OF MAP CODE//////////////////////////////////////////////////////////////////////

    function login_btn_click() {
        window.open('login');
    }

    function register_btn_click() {
        window.open('register');
    }


</script>

<body>
<div class="s01">


    <form action="" method="post">
        {% csrf_token %}
        <fieldset>
            <legend>HouseMap</legend>
        </fieldset>


        <!------------------------------------------------------------------------>
        {% if user.is_authenticated %}
            Hi {{ user.username }}!
            <p><a href="{% url 'logout' %}">logout</a></p>
            <p><a href="{% url 'password_reset' %}">reset password</a></p>
        {% else %}
            <p>You are not logged in</p>
            <a href="{% url 'login' %}">login</a>
            <a href="{% url 'signup' %}">signup</a>
        {% endif %}
        <!------------------------------------------------------------------------>

        <div class="inner-form">

            <div class="input-field first-wrap">
                <input name="address" type="text" placeholder="輸入地址"/>
            </div>
            <div class="input-field second-wrap">
                <input name="range" type="text" placeholder="設定範圍"/>
            </div>
            <div class="input-field third-wrap">
                <button class="btn-search" type="submit" id="search_btn">搜尋</button>
            </div>

            <div class="input-field third-wrap">
                <button id="search_record_btn" class="btn-search" type="button" onclick="search_record_btn_click()">
                    <a href="/search_record/" style="color:white; text-decoration:none;">
                        搜尋紀錄
                    </a>
                </button>
            </div>
        </div>

        <div>
            <div id="twzipcode"></div>
            <script>
                $("#twzipcode").twzipcode();
                var array = $("#twzipcode").twzipcode('get', 'county,district');
                $.ajax({
                    type: "POST",
                    url: "",
                    data: {
                        'county': array[0],
                        'district': array[1],// from form
                        // all of this data is submitted via POST to your view.
                        // in django, request.POST['background-color']
                    },
                    headers: {
                        'X-CSRFTOKEN': "{{ csrf_token }}",
                    },
                    success: function (data) {

                    }
                });


            </script>
        </div>


        <div class="dropdown">
            <select> {% for show_item in Show_filter %}
                <option value="{{ show_item.title }}">{{ show_item.title }}</option> {% endfor %} </select>
        </div>


        <div id="map" class="inner-form">
            {#            <div id="map"></div>#}
        </div>

        <!--
                <div class="inner-form">
                    <div class="input-field third-wrap">
                        <button class="btn-login-register" type="button" onclick="login_btn_click()">登入</button>
                    </div>
                </div>
                <div class="inner-form">
                    <div class="input-field third-wrap">
                        <button class="btn-login-register" type="button" onclick="register_btn_click()">註冊會員</button>
                    </div>
                </div>
        -->

    </form>
</div>
<!-- This templates was made by Colorlib (https://colorlib.com) -->
</body>
</html>
